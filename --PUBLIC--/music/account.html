<!doctype html>
<html lang="en">
  <head>
    <script src="https://kit.fontawesome.com/0f81b9a2a2.js" crossorigin="anonymous"></script>
    <link href="./a.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" ></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-storage.js"></script> 
   <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-database.js"></script>
   <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-analytics.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Dewey's World Team">
    <meta name="generator" content="Hugo 0.101.0">
    <title>Account : Dewey Auth</title>
    <link rel="canonical" href="https://getbootstrap.com/docs/5.2/examples/sign-in/">
    <link href="https://getbootstrap.com/docs/5.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <!-- Favicons -->
    <link rel="apple-touch-icon" href="https://firebasestorage.googleapis.com/v0/b/free-cloud-de.appspot.com/o/logo3.png?alt=media" sizes="180x180">
    <link rel="icon" href="https://firebasestorage.googleapis.com/v0/b/free-cloud-de.appspot.com/o/logo3.png?alt=media" sizes="32x32" type="image/png">
    <link rel="manifest" href="https://getbootstrap.com/docs/5.2/assets/img/favicons/manifest.json">
    <meta name="theme-color" content="#f5f5f5">
  </head>
 <script>
  var config = {
    apiKey: "AIzaSyBhd3_KEAOyJnbIp-vNd5YoVUiyOiaZuoQ",
    authDomain: "beta-deweysworld.firebaseapp.com",
    databaseURL: "https://beta-deweysworld-default-rtdb.firebaseio.com",
    projectId: "beta-deweysworld",
    storageBucket: "beta-deweysworld.appspot.com",
    messagingSenderId: "851425328095",
    appId: "1:851425328095:web:d3ccd702d04abe9f7fe26a",
    measurementId: "G-V3Q2GSB2RW"
  };
  firebase.initializeApp(config);
  const analytics = firebase.analytics();
  </script>
  <body class="text-center">   
  <main class="form-signin w-100 m-auto">
      <!--MENU-->
      <div id="lineicon" class="lineicon">
        <a style="background-color: transparent;height:100%;width:80px;" href="./index.html"><i class="fa-solid fa-plus"></i><br>Add</a>
        <a style="background-color: transparent;height:100%;width:80px;" href="./list.html"><i class="fa-solid fa-list"></i><br>List</a>
        <a style="background-color: transparent;height:100%;width:80px;" href="./account.html"><i class="fa-solid fa-user"></i><br>Account</a>
        <style>
            #lineicon {
                width: 240px;
                height: 50px;
                background-color: #ffffffd3; /* Default color for cart with items */
                color: #494949; /* Change the text color as needed */
                padding: 10px;
                border-radius: 20px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center; /* Center text horizontally */
                text-align: center;
            }
            #lineicon a {
                color: #000000a3;
                margin-top: 5px;
                margin-bottom: 5px;
                transition: 0.3s ease-in-out;
            }
            #lineicon a:hover {
                color: black;
                scale: 1.05;
            }
        </style>
    </div>
    <!--MENU-->
    <!--Cookie-->
    <style>
      .acookie { color: blue; text-decoration: none; }
      .alertcookie { display: none; padding: 20px; font-size: 12px; background-color: #f1ffba; color: rgb(0, 0, 0); border-radius: 20px; }
      .closecookie { margin-left: 15px; color: rgb(84, 84, 84); font-weight: bold; float: right; font-size: 22px; line-height: 20px; cursor: pointer; transition: 0.3s; }
      .closecookie:hover { color: rgb(255, 30, 30); }
    </style>
    
    <script>
      // Function to set a cookie with a given name, value, and expiration time
      function setCookie(name, value, minutes) {
        var d = new Date();
        d.setTime(d.getTime() + (minutes * 60 * 1000));
        var expires = "expires=" + d.toUTCString();
        document.cookie = name + "=" + value + ";" + expires + ";path=/";
      }
    
      // Function to get the value of a cookie by name
      function getCookie(name) {
        var decodedCookie = decodeURIComponent(document.cookie);
        var cookies = decodedCookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          if (cookie.indexOf(name + "=") === 0) {
            return cookie.substring(name.length + 1);
          }
        }
        return "";
      }
    
      // Function to handle the click event on the close button
      function closeCookieBanner() {
        // Set a cookie named 'closedCookieBanner' with value 'true' and expiration time of 10 minutes
        setCookie('closedCookieBanner', 'true', 10);
        // Hide the cookie banner
        document.querySelector('.alertcookie').style.display = 'none';
      }
    
      // Function to check if the cookie banner should be displayed
      function checkCookieBanner() {
        // Get the value of the 'closedCookieBanner' cookie
        var closedCookieBanner = getCookie('closedCookieBanner');
        // Check if the cookie is not set or if it's been more than 10 minutes since it was set
        if (closedCookieBanner === '' || (closedCookieBanner === 'true' && Date.now() - new Date(closedCookieBanner) > 10 * 60 * 1000)) {
          // Show the cookie banner
          document.querySelector('.alertcookie').style.display = 'block';
        }
      }
    
      // Call the checkCookieBanner function when the page loads
      window.onload = checkCookieBanner;
    </script>
    
    <div class="alertcookie">
      <span class="closecookie" onclick="closeCookieBanner();">&times;</span>
      <strong>Cookies </strong>เราใช้คุ๊กกี้เพื่อเพิ่มประสบการณ์การใช้งานของคุณให้สมบูรณ์และมีประสิทธิภาพมากขึ้น ถ้าท่านใช้งานเว็บไซต์ของเราต่อไปถือว่าท่านได้ยอมรับ <a class="acookie" href="/privacy">นโยบายการคุ้มครองข้อมูลส่วนบุคคล</a>ของเราแล้ว
    </div>
    <!--Cookie-->
    <div class="container">
        <br /><br />
        <main class="form-signin w-100 m-auto">
          <div id="login_panel">
              <h1>Your Account</h1>
              <img id="userimg" style="border-radius: 22%;" class="mb-4" src="https://firebasestorage.googleapis.com/v0/b/free-cloud-de.appspot.com/o/DeweysWorldBETA.png?alt=media" alt="" width="100" height="100">
              <p>Username: <span class="user_info">Loading...</span></p>
              <p>Email: <span class="user_email">Loading...</span></p>
              <p>ID: <span class="user_uid">Loading...</span></p>
              <button id="edit-profile-button" class="btn btn-primary"><i class="fa-solid fa-pen-to-square"></i> Edit Profile</button><br><br>
              <!-- Add an "id" to the Sign Out button -->
<button id="sign-out-button" class="btn_sign_out">
  <i class="fa fa-sign-out-alt"></i> Sign Out
</button>
          </div>
  
          <div id="profile-form-section" style="display: none;">
            <h2>Edit Your Profile</h2>
            <form class="profile-form" id="profile-form">
                <!-- Form inputs for editing profile -->
                <input type="email" class="email" id="new-email" placeholder="New Email"><br>
                <input type="text" class="username" id="new-username" placeholder="New Username"><br>
                <input type="file" class="new-img" id="new-profile-picture" accept="image/*" placeholder="New Profile Picture"><br>
            </form><br>
            <button id="save-profile-button" class="btn btn-primary"><i class="fa-solid fa-floppy-disk"></i> Save Profile</button>
            <button id="cancel-edit-button" class="btn btn-secondary"><i class="fa-solid fa-xmark"></i> Cancel</button><br><br>
            <button id="backza-button" class="btn btn-secondary"> <i class="fa-solid fa-backward"></i>    Back</button>
            <p id="update-message"></p>
            <p id="update-message2"></p>
            <p id="update-message3"></p>
            <p id="update-message4"></p>
        </div>
    

             <br>
             <br>
              <span class="ulog" ></span>
              <button class="btn_login" style="display:none" >
                     <i class="fa fa-sign-out-alt" ></i> Sign Iท
              </button>
              <br>
              <br>
              <br>
              <div class="text-right">
                <a href="javascript:history.back()"><i class="fa-solid fa-backward"></i> Back</a>
              </div>

<br><br><br><br>
<div class="container" style="margin-top: 100px;">
    <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4">
      <p style="font-size: smaller;text-align:center;">&copy; 2025 TUB3.xyz by Dewey's World</p>   
      
  
      <a href="/" class="col-md-4 d-flex align-items-center justify-content-center mb-3 mb-md-0 me-md-auto link-dark text-decoration-none">
        <img src="./logo.png" style="width: 50px;" class="footer-logo">
      </a>
  
      <ul style="text-align: left;list-style-type: none;">

        <li class="nav-item"><a href="./index.html" class="nav-link px-2 text-muted"><i class="fa-solid fa-plus"></i> Add</a></li>
        <li class="nav-item"><a href="./list.html" class="nav-link px-2 text-muted"><i class="fa-solid fa-list"></i> List</a></li>
        <li class="nav-item"><a href="./account.html" class="nav-link px-2 text-muted"><i class="fa-solid fa-user"></i> Account</a></li>
        <!--<li class="nav-item"><a href="#" class="nav-link px-2 text-muted">FAQs</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">About</a></li> --> 
      </ul>             
    </footer>
  </div>
        </div>
        
    <style>
      
    </style>
        <script>
          document.getElementById('edit-profile-button').addEventListener('click', function () {
            // Hide the user-profile section and show the profile-form section
            document.getElementById('login_panel').style.display = 'none';
            document.getElementById('profile-form-section').style.display = 'block';
        });

        // Add an event listener to the "Cancel" button to go back to the user-profile section
        document.getElementById('cancel-edit-button').addEventListener('click', function () {
            // Hide the profile-form section and show the user-profile section
            document.getElementById('profile-form-section').style.display = 'none';
            document.getElementById('login_panel').style.display = 'block';
        });
        document.getElementById('backza-button').addEventListener('click', function () {
          // Hide the profile-form section and show the user-profile section
          location.reload()
      });
        
        // Add an event listener to handle profile updates when "Save Profile" is clicked
        var storageRef = firebase.storage().ref();

        // Add an event listener to the "Save Profile" button
        document.getElementById('save-profile-button').addEventListener('click', async function () {
            // Get user data from the form
            const newUsername = document.getElementById('new-username').value;
            const newEmail = document.getElementById('new-email').value;
            const newProfilePicture = document.getElementById('new-profile-picture').files[0];

            // Update user's profile information in Firebase Authentication
            const user = firebase.auth().currentUser;
            try {
                if (newUsername) {
                    await user.updateProfile({
                        displayName: newUsername
                    });
                }
                if (newEmail) {
                  await user.updateEmail(newEmail);
              }

                // Upload the new profile picture to Firebase Storage
                if (newProfilePicture) {
                    const profilePictureRef = storageRef.child(`profile_pictures/${user.uid}`);
                    const snapshot = await profilePictureRef.put(newProfilePicture);
                    const downloadURL = await snapshot.ref.getDownloadURL();

                    // Update user's photoURL in Firebase Authentication
                    await user.updateProfile({
                        photoURL: downloadURL
                    });
                }

                // Display the update message
                const updateMessage = document.getElementById('update-message');
                const updateMessage2 = document.getElementById('update-message2');
                const updateMessage3 = document.getElementById('update-message3');
                const updateMessage4 = document.getElementById('update-message4');
                updateMessage.textContent = 'Profile updated successfully!';
                updateMessage2.textContent = 'Current Username is: '+user.email;
                updateMessage3.textContent = 'Current Username is: '+user.displayName;
                updateMessage4.textContent = 'Current PhotoURL is: '+user.photoURL;
            } catch (error) {
                console.error(error);
                const updateMessage = document.getElementById('update-message');
                updateMessage.textContent = 'Error updating profile: ' + error.message;
            }
        });


      </script>
      <script>

          var timestampa=new Date().getTime();
          var currentURL = window.location.href;
          console.log(timestampa);





          $("#login_panel").find(".btn_login").on("click",function(){
            //เมื่อกดปุ่มเข้าสู่ระบบแล้ว ให้ไปที่ หน้าจอของ google
            var GoogleAuthProvider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithPopup(GoogleAuthProvider);

    });

    
        
    
    
    
               
                 //signout
// Add an event listener to the "Sign Out" button
document.getElementById('sign-out-button').addEventListener('click', function () {
  // Sign out the current user
  firebase.auth().signOut().then(function () {
      alert("Logged Out!");
  }).catch(function (error) {
      console.error("Error signing out: " + error.message);
  });
});

                //user changed
                firebase.auth().onAuthStateChanged(function(user) {
                  if (user) {
                    console.log(user);
                    $("#login_panel").find(".btn_login").css("display", "none");
                    $("#login_panel").find(".btn_sign_out").css("display", "");
                    $("#login_panel").find(".user_info").html(user.displayName);
                    if (user.photoURL) {
                      // Set the src attribute of the "userimg" element to the profile image URL
                      $("#userimg").attr("src", user.photoURL);
                    } else {
                      // If the user doesn't have a profile image, you can set a default image or hide the element.
                      $("#userimg").attr("src", "https://firebasestorage.googleapis.com/v0/b/free-cloud-de.appspot.com/o/DeweysWorldBETA.png?alt=media");
                    }
                    if (user.email) {
                      $("#login_panel").find(".user_email").html(user.email);
                  } else {
                  }
                  if (user.uid) {
                    $("#login_panel").find(".user_uid").html(user.uid);
                } else {
                }
                  } else {
                    $("#login_panel").find(".btn_login").css("display", "");
                    $("#login_panel").find(".btn_sign_out").css("display", "none");
                    $("#login_panel").find(".user_info").html(""); // Clear user info
                    alert("Please Login");
                    window.location.href = "./login.html";
                  }
                });
    
        </script>
    
    </div>
    
    
    


    

</main>


  </body>
</html>