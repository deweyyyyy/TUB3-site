<!doctype html>
<html lang="en">
  <head>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="./auth.js"></script>
    <script src="https://kit.fontawesome.com/0f81b9a2a2.js" crossorigin="anonymous"></script>
    <link href="./a.css?999" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" ></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-storage.js"></script> 
   <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-database.js"></script>
   <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-analytics.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Dewey's World Team">
    <meta name="generator" content="Hugo 0.101.0">
    <title>TUB3 Auth</title>
    <link rel="canonical" href="https://getbootstrap.com/docs/5.2/examples/sign-in/">
    <link href="https://getbootstrap.com/docs/5.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <!-- Favicons -->
    
    <link rel="icon" href="./files/image/logo3.png" sizes="32x32" type="image/png">
    <link rel="manifest" href="https://getbootstrap.com/docs/5.2/assets/img/favicons/manifest.json">
    
    <meta name="theme-color" content="#f5f5f5">
  </head>
 <script>
    var config = {
      apiKey: "AIzaSyBhd3_KEAOyJnbIp-vNd5YoVUiyOiaZuoQ",
      authDomain: "beta-deweysworld.firebaseapp.com",
      databaseURL: "https://beta-deweysworld-default-rtdb.firebaseio.com",
      projectId: "beta-deweysworld",
      storageBucket: "beta-deweysworld.appspot.com",
      messagingSenderId: "851425328095",
      appId: "1:851425328095:web:d3ccd702d04abe9f7fe26a",
      measurementId: "G-V3Q2GSB2RW"
    };
    firebase.initializeApp(config);
    const analytics = firebase.analytics();
  </script>
  <body class="text-center">   
  <main class="form-signin w-100 m-auto">
    <div id="lineicon" class="lineicon">
      <a style="background-color: transparent;height:100%;width:80px;" href="./index.html"><i class="fa-solid fa-plus"></i><br>Add</a>
      <a style="background-color: transparent;height:100%;width:80px;" href="./list.html"><i class="fa-solid fa-list"></i><br>List</a>
      <a style="background-color: transparent;height:100%;width:80px;" href="./account.html"><i class="fa-solid fa-user"></i><br>Account</a>
      <style>
          #lineicon {
              width: 240px;
              height: 50px;
              background-color: #ffffffd3; /* Default color for cart with items */
              color: #494949; /* Change the text color as needed */
              padding: 10px;
              border-radius: 20px;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center; /* Center text horizontally */
              text-align: center;
          }
          #lineicon a {
              color: #000000a3;
              margin-top: 5px;
              margin-bottom: 5px;
              transition: 0.3s ease-in-out;
          }
          #lineicon a:hover {
              color: black;
              scale: 1.05;
          }
      </style>
  </div>
      <!--Cookie-->
      <div style="display: none;" class="overlay"></div>
      <link rel="stylesheet" href="https://deweysworld.app/cookie.css"> 
      <script src="https://deweysworld.app/cookie.js"></script>
      <div style="display: none;" class="alertcookie">
        <span class="closecookie" onclick="closeCookieBanner();">&times;</span>
        <i style="color: chocolate;" class="fa-solid fa-cookie-bite"></i>
        <strong>Cookies </strong>เราใช้คุ๊กกี้เพื่อเพิ่มประสบการณ์การใช้งานของคุณให้สมบูรณ์และมีประสิทธิภาพมากขึ้น ถ้าท่านใช้งานเว็บไซต์ของเราต่อไปถือว่าท่านได้ยอมรับ <a class="acookie" href="/privacy">นโยบายการคุ้มครองข้อมูลส่วนบุคคล</a>ของเราแล้ว
        <br><a class="confirmcookie" onclick="closeCookieBanner();">ยอมรับ</a>
      </div>
      <!--Cookie-->

    <img class="mb-4" src="https://firebasestorage.googleapis.com/v0/b/free-cloud-de.appspot.com/o/DeweysWorldBETA.png?alt=media" alt="" width="100" height="100" style="margin-top: 30px;">
    <h1 class="h3 mb-3 fw-normal">Dewey's World BETA Auth<br>เพื่อนำไปสู่ TUB3.xyz</h1>
    <div style="display: none;" id="plzsupport">
      <h4 style="color: red;">โปรดเปิดใน Safari/Chrome<br>เพื่อดำเนินการต่อด้วย Google</h4>
      <h5 style="color: red;">ไม่รองรับการเปิดผ่าน LINE, IG, e.g.</h5>
      <h6 style="color: red;">ขออภัยในความไม่สะดวก เนื่องด้วยความปลอดภัย</h6>
    </div>

      <!-- Loading overlay -->
  <div id="loadingOverlay" class="overlayloading">
    <img src="https://deweyworldbu.web.app/files/loadingmini.gif" alt="Loading..." />
  </div>

  <style>
    /* Loading overlay style */
    .overlayloading {
      display: none;
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      background-color: rgb(255, 255, 255);
      z-index: 9999;
    }
  
    .overlayloading img {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
  
    <div class="container">
  
        <br /><br />
          <div id="login_panel" class='text-right' >
            <button id="google-sign-in" class="btn_login "  >
            Sign In with Google
       </button>
       <br>
       <br>
  <div class="userpass">
    <input class="email"type="email" id="email_input" placeholder="Email">
  <input class="password"type="password" id="password_input" placeholder="Password">
  </div>
  <button id="btn_login2" class="btn_login2 "  >
    <i class="fa-solid fa-envelope"></i> Sign In
  </button>
  <a href="./register.html"><h6>Register new account?</h6></a>
  <a href="./reset.html"><h6>Forgot password?</h6></a>

             <br>
             <br>

    
              <!--  สร้าง span สำหรับ  --> 
              <span class="user_info" ></span>
              <!--  สร้าง ออกจากระบบ ระบบโดยกำหนดให้ยังไม่แสดงในครั้งแรก  --> 
              <button class="btn_sign_out " style="display:none" >
                     <i class="fa fa-sign-out-alt" ></i> Sign Out
              </button>
              <br><br>
              <a href="javascript:history.back()"><i class="fa-solid fa-backward"></i> Back</a>





<br><br><br><br>



              <div style="margin-top: 30px; width:80vw;">
                 
                <footer class="py-4">
                  <div class="container">
                    <div class="row align-items-center">
                      <!-- Logo Section -->
                      <div class="col-md-6 text-center text-md-left mb-3 mb-md-0">
                        <a href="/" class="d-flex align-items-center justify-content-center justify-content-md-start link-dark">
                          <img src="https://firebasestorage.googleapis.com/v0/b/free-cloud-de.appspot.com/o/DeweysWorldBETA.png?alt=media" style="width: 50px;" class="footer-logo">
                        </a>
                      </div>
                
                      <!-- Copyright Section -->
                      <div class="col-md-6 text-center text-md-right">
                        <p class="mb-0" style="font-size: 0.875rem; color: #6c757d;">&copy; 2024 TUB3.xyz by Dewey's World</p>
                      </div>
                    </div>
                  </div>
                </footer>
                
                
                
                
              </div>
        </div>
        
    <style>
      
    </style>
        <script>


          function showLoadingOverlay() {
            document.getElementById('loadingOverlay').style.display = 'block';
          }
        
          // Function to hide loading overlay
          function hideLoadingOverlay() {
            document.getElementById('loadingOverlay').style.display = 'none';
          }

          document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                document.getElementById("btn_login2").click();
            }
        });


          var timestampa=new Date().getTime();
          var currentURL = window.location.href;
          console.log(timestampa);



          $("#login_panel").find(".btn_login").on("click", function() {
            showLoadingOverlay();
        
            // Google Authentication Provider
            var googleAuthProvider = new firebase.auth.GoogleAuthProvider();
        
            // Sign in with popup and handle errors
            firebase.auth().signInWithPopup(googleAuthProvider)
                .then(function(result) {
                    // Hide the loading overlay if login is successful
                    hideLoadingOverlay();
                    // Additional code for successful login, if needed
                })
                .catch(function(error) {
                    // Hide the loading overlay on error
                    hideLoadingOverlay();
        
                    // Show SweetAlert error message
                    Swal.fire({
                        icon: 'error',
                        title: 'Login Failed',
                        text: error.message || 'An error occurred during login. Please try again.',
                        confirmButtonText: 'OK'
                    });
                });
        });
        
    $("#login_panel").find(".btn_login2").on("click", function() {
      showLoadingOverlay() ;
      // When the "btn_login" element inside the "login_panel" is clicked:
      
      // Get the user's email and password from input fields (replace these with your actual input field IDs)
      var email = $("#email_input").val();
      var password = $("#password_input").val();
      // Use Firebase's signInWithEmailAndPassword method for email and password authentication.
      firebase.auth().signInWithEmailAndPassword(email, password)
          .then(function(userCredential) {
              // Authentication successful, you can access user data if needed.
              var user = userCredential.user;
              hideLoadingOverlay();
              Swal.fire({
                icon: 'success',
                title: 'Authentication Successful!',
                text: 'User: ' + user.email,
              });
              document.getElementById('message').textContent = '';
          })
          .catch(function(error) {
              // Handle authentication errors here.
              hideLoadingOverlay();
              var errorCode = error.code;
              var errorMessagea = error.message;
              if (errorMessagea == '{"error":{"code":400,"message":"INVALID_LOGIN_CREDENTIALS","errors":[{"message":"INVALID_LOGIN_CREDENTIALS","domain":"global","reason":"invalid"}]}}') {
                var errorMessage = "Email/Password is wrong. Try Again.";
              }
              Swal.fire({
                icon: 'error',
                title: 'Authentication Failed!',
                text: 'Error Message: ' + errorMessage,
              });
          });
  });
    
    
    
        
    
    
    
               
                 //signout
                $("#login_panel").find(".btn_sign_out").on("click",function(){
                    //คำสั่ง ออกจการะบบ ของ firebase
                    firebase.auth().signOut().then(function() {
                        
                    });
    
                });
                //user changed
                firebase.auth().onAuthStateChanged(function(user) {
    
                    if (user)//user
                    {
              
                      console.log(user);
                      $("#login_panel").find(".btn_login").css("display","none");
                      $("#login_panel").find(".btn_sign_out").css("display","");
                      $("#login_panel").find(".user_info").html(user.displayName);
                      Swal.fire({
                        icon: 'success',
                        title: 'Redirecting to Main Page...',
                        timer: 1000,
                        timerProgressBar: true,
                        didOpen: () => {
                          Swal.showLoading();
                          const timerInterval = setInterval(() => {
                            const content = Swal.getContent();
                            if (content) {
                              const progressBar = content.querySelector('div > div > div.swal2-progress-bar');
                              if (progressBar) {
                                progressBar.style.width = Swal.getTimerLeft() / 30 + '%';
                              }
                            }
                          }, 100);
                          Swal.showLoading();
                          setTimeout(() => {
                            clearInterval(timerInterval);
                            window.location.href = "./index.html";
                          }, 1000);
                        }
                      });
                  } 
                  else // เมื่อผู้ใช้ไม่ได้อยู่ใน สถานะ login
                  {
                      $("#login_panel").find(".btn_sign_out").css("display","none");//ซ่อนปุ่ม ออกจากระบบ
                      $("#login_panel").find(".user_info").html("");//ซ่อนชื่อผู้ใช้ 
                      
                     
    
                  }
                }); 
        </script>
    
    </div>
    
    
    


    

</main>


  </body>
</html>

